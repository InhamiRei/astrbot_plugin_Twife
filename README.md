# 抽老婆插件重构说明

## 重构目标

将原来 3500 行的单一文件拆分为模块化的文件结构，提高代码可维护性和可读性。

## 新的文件结构

```
astrbot_plugin_aw/
├── main.py                    # 原始主文件 (3500行)
├── main_new.py               # 重构后的主文件 (精简版)
├── config/                   # 配置模块
│   ├── __init__.py
│   ├── settings.py          # 基本设置和常量
│   ├── properties.py        # 房产配置
│   ├── education.py         # 学历配置
│   ├── events.py           # 游戏事件配置
│   └── messages.py         # 消息文本配置
├── core/                    # 核心功能模块
│   ├── __init__.py
│   ├── data_manager.py     # 数据管理 (数据加载/保存/操作)
│   ├── wife_system.py      # 老婆系统核心逻辑
│   ├── ntr_system.py       # NTR系统核心逻辑
│   └── education_system.py # 学习系统核心逻辑
├── utils/                   # 工具函数模块
│   ├── __init__.py
│   ├── formatters.py       # 格式化工具
│   ├── validators.py       # 验证工具
│   └── time_utils.py       # 时间工具
└── handlers/                # 命令处理器模块
    ├── __init__.py
    └── wife_handler.py      # 老婆相关命令处理器
```

## 模块功能说明

### 配置模块 (config/)

- **settings.py**: 基本设置、文件路径、游戏规则配置
- **properties.py**: 房产等级配置和相关函数
- **education.py**: 学历等级配置和相关函数
- **events.py**: 出门转转等游戏事件配置
- **messages.py**: 各种游戏消息文本和好感度描述

### 核心模块 (core/)

- **data_manager.py**: 统一管理所有数据的加载、保存和操作
- **wife_system.py**: 抽老婆、确认老婆等核心逻辑
- **ntr_system.py**: NTR 相关的所有逻辑
- **education_system.py**: 学习系统的核心逻辑

### 工具模块 (utils/)

- **formatters.py**: 格式化显示相关的工具函数
- **validators.py**: 数据验证相关的工具函数
- **time_utils.py**: 时间处理相关的工具函数

### 处理器模块 (handlers/)

- **wife_handler.py**: 处理老婆相关的所有命令

## 重构优势

1. **代码组织更清晰**: 按功能模块分离，易于定位和修改
2. **维护性提高**: 单个文件代码量减少，修改影响范围更小
3. **可读性增强**: 每个模块职责单一，代码逻辑更清晰
4. **扩展性更好**: 新功能可以独立模块开发，不影响现有代码
5. **配置分离**: 配置信息独立管理，便于调整游戏参数

## 使用说明

目前重构已完成，主要完成了：

- ✅ 文件结构设计
- ✅ 配置模块完整实现
- ✅ 数据管理模块完整实现
- ✅ 工具函数模块完整实现
- ✅ 老婆系统核心逻辑
- ✅ NTR 系统核心逻辑
- ✅ 学习系统核心逻辑
- ✅ 工作系统核心逻辑
- ✅ 所有命令处理器完整实现
- ✅ 主文件重构和代码清理

✅ **迁移已完成！** 所有功能都已成功迁移到模块化结构：

1. ✅ 所有命令处理器已迁移
2. ✅ 所有核心系统已迁移
3. ✅ 主文件已重构并清理
4. ✅ 所有配置已模块化

**新的 main.py 现在只有约 250 行代码**，相比原来的 3500 行，代码更加清晰易维护！

## 建议的迁移步骤

1. **备份原文件**: 确保有`main copy.py`作为备份
2. **测试新系统**: 在测试环境中验证所有功能
3. **替换主文件**: 确认无误后替换原`main.py`
4. **监控运行**: 部署后密切观察系统运行状况

## 🎉 迁移完成情况

**所有 21 个命令功能已全部完成迁移：**

### 老婆系统 (4 个命令)

- ✅ 抽老婆 - 抽取候选老婆
- ✅ 确认老婆 - 选择心仪老婆
- ✅ 查老婆 - 查看老婆信息
- ✅ 净身出户 - 离婚功能

### NTR 与纯爱系统 (5 个命令)

- ✅ 牛老婆 - NTR 别人老婆
- ✅ 牛头人盛宴 - 提高 NTR 成功率
- ✅ 牛头人无可匹敌 - 获得额外机会
- ✅ 纯爱无敌 - 永久防 NTR 保护
- ✅ 纯爱破碎 - 取消保护状态

### 房产系统 (2 个命令)

- ✅ 房产中心 - 查看房产信息
- ✅ 升级房产 - 使用金币升级

### 购物与资产系统 (6 个命令)

- ✅ 出门转转 - 外出探险获得物品
- ✅ 资产查询 - 查看个人资产
- ✅ 赠送礼物 - 给老婆送礼
- ✅ 出售物品 - 物品换金币
- ✅ 超市列表 - 查看商品
- ✅ 购买物品 - 超市购物

### 工作学习系统 (3 个命令)

- ✅ 出门学习 - 学习增加经验
- ✅ 打工列表 - 查看工作
- ✅ 出门打工 - 工作赚金币

### 系统命令 (1 个命令)

- ✅ 抽老婆菜单 - 显示完整菜单

## 性能优化成果

- **代码行数**: 从 3500 行减少到约 250 行 (减少 93%)
- **文件数量**: 从 1 个巨大文件拆分为 15 个专业模块
- **维护性**: 功能模块化，bug 定位和修复效率大幅提升
- **扩展性**: 新功能可独立开发，不影响现有代码

这个重构为插件的长期维护和功能扩展奠定了良好的基础。
